<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificado de Conclusão - Alpha Cursos</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css"> <!-- Base Variables -->
    <link rel="stylesheet" href="css/certificate.css"> <!-- New Certificate Styles -->
</head>

<body>

    <div class="cert-container">

        <!-- Loading State -->
        <div id="loading">
            <span class="material-symbols-outlined spin" style="font-size: 3rem;">sync</span>
            <p>Validando autenticidade...</p>
        </div>

        <!-- Error State -->
        <div id="error-msg" class="hidden">
            <span class="material-symbols-outlined" style="font-size: 3rem; color: #ef4444;">error</span>
            <h2>Certificado não encontrado</h2>
            <p>Verifique o link ou entre em contato com o suporte.</p>
        </div>

        <!-- Certificate Card -->
        <div id="certificate" class="certificate hidden">
            <div class="cert-frame">
                <!-- Watermark -->
                <div class="watermark">LYKOS</div>

                <!-- Header -->
                <header class="cert-header">
                    <span class="org-logo">LYKOS</span>
                    <h1 class="cert-title">Certificado</h1>
                    <p class="cert-subtitle">de Conclusão de Curso</p>
                </header>

                <!-- Body -->
                <div class="cert-body">
                    <p>Certificamos que</p>
                    <span id="student-name" class="student-name">Carregando...</span>
                    <p>concluiu com êxito o curso de</p>
                    <span id="course-title" class="course-name">Carregando...</span>

                    <p class="workload-info">
                        Carga Horária Estimada: <strong id="workload">--</strong> horas
                    </p>
                </div>

                <!-- Footer -->
                <footer class="cert-footer">
                    <div class="signature-block">
                        <div class="sign-line">
                            <span id="instructor-name">Instrutor</span>
                        </div>
                        <span class="sign-role">Instrutor Responsável</span>
                    </div>

                    <div class="signature-block">
                        <div class="sign-line" style="font-family: 'Libre Baskerville', serif;">
                            Diretoria Acadêmica
                        </div>
                        <span class="sign-role">LYKOS</span>
                    </div>

                    <div class="verification-block">
                        <p>Emitido em: <span id="issue-date">--/--/----</span></p>
                        <p>Código de Validação:</p>
                        <span id="cert-hash" class="cert-hash">--------------------</span>
                    </div>
                </footer>
            </div>
        </div>

        <!-- Floating Actions -->
        <div class="cert-actions" id="cert-actions-container">
            <button id="btn-download" class="btn-download">
                <span class="material-symbols-outlined">print</span>
                Imprimir / Salvar PDF
            </button>
        </div>

    </div>

    <!-- PDF Library -->
    <script src="js/libs/html2pdf.bundle.min.js"></script>

    <script src="js/certificate.js"></script>

    <script>

        async function loadCertificate() {
            const params = new URLSearchParams(window.location.search);
            const hash = params.get('hash');

            if (!hash) {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('error-msg').classList.remove('hidden');
                document.getElementById('cert-actions').style.display = 'none';
                return;
            }

            try {
                // Fetch Certificate Data
                const res = await fetch(`/certificates/${hash}`);
                const data = await res.json();

                if (res.ok && data.data) {
                    const cert = data.data;
                    document.getElementById('student-name').textContent = cert.studentName;
                    document.getElementById('course-title').textContent = cert.courseTitle;
                    document.getElementById('workload').textContent = cert.workloadHours;
                    document.getElementById('instructor-name').textContent = cert.instructorName;
                    document.getElementById('cert-hash').textContent = cert.certificateHash;
                    document.getElementById('issue-date').textContent = new Date(cert.issuedAt).toLocaleDateString('pt-BR');

                    // Show content
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('certificate').classList.remove('hidden');

                    // Update Title
                    document.title = `Certificado - ${cert.studentName}`;
                } else {
                    throw new Error('Not found');
                }
            } catch (error) {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('error-msg').classList.remove('hidden');
                document.getElementById('cert-actions').style.display = 'none';
            }
        }

        loadCertificate();
    </script>
</body>

</html>