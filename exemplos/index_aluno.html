<!DOCTYPE html>

<html class="dark" lang="pt-br><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Chemistry Student Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#0ddff2",
                        "background-light": "#f5f8f8",
                        "background-dark": "#102122",
                    },
                    fontFamily: {
                        "display": ["Space Grotesk", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                },
            },
        }
    </script>
<style>
        body {
            font-family: 'Space Grotesk', sans-serif;
        }
        .hex-bg {
            background-image: radial-gradient(circle at 2px 2px, rgba(13, 223, 242, 0.05) 1px, transparent 0);
            background-size: 32px 32px;
        }
        .achievement-glow:hover {
            box-shadow: 0 0 15px rgba(13, 223, 242, 0.4);
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-white min-h-screen">
<div class="flex min-h-screen w-full overflow-x-hidden hex-bg">
<!-- Sidebar Navigation -->
<aside class="w-72 flex-shrink-0 border-r border-slate-200 dark:border-slate-800 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-md sticky top-0 h-screen p-6 flex flex-col justify-between">
<div class="flex flex-col gap-8">
<!-- Branding -->
<div class="flex items-center gap-3 px-2">
<div class="bg-primary p-2 rounded-lg">
<span class="material-symbols-outlined text-background-dark font-bold">science</span>
</div>
<div>
<h1 class="text-lg font-bold leading-tight tracking-tight">Área do Aluno</h1>
<p class="text-xs text-slate-500 dark:text-[#9cb7ba]">Chemistry Scholar</p>
</div>
</div>
<!-- Nav Menu -->
<nav class="flex flex-col gap-2">
<a class="flex items-center gap-3 px-4 py-3 rounded-xl bg-primary/10 text-primary border border-primary/20" href="#">
<span class="material-symbols-outlined fill-1">school</span>
<span class="text-sm font-medium">My Courses</span>
</a>
<a class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 dark:text-[#9cb7ba] hover:bg-slate-100 dark:hover:bg-white/5 transition-colors" href="#">
<span class="material-symbols-outlined">analytics</span>
<span class="text-sm font-medium">Progress</span>
</a>
<a class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 dark:text-[#9cb7ba] hover:bg-slate-100 dark:hover:bg-white/5 transition-colors" href="#">
<span class="material-symbols-outlined">verified</span>
<span class="text-sm font-medium">Certificates</span>
</a>
<a class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 dark:text-[#9cb7ba] hover:bg-slate-100 dark:hover:bg-white/5 transition-colors" href="#">
<span class="material-symbols-outlined">groups</span>
<span class="text-sm font-medium">Community</span>
</a>
<a class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 dark:text-[#9cb7ba] hover:bg-slate-100 dark:hover:bg-white/5 transition-colors" href="#">
<span class="material-symbols-outlined">help_center</span>
<span class="text-sm font-medium">Support</span>
</a>
</nav>
</div>
<div class="flex flex-col gap-4">
<div class="p-4 rounded-xl bg-slate-100 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700/50">
<p class="text-xs text-slate-500 dark:text-[#9cb7ba] mb-2 uppercase font-bold tracking-wider">Storage</p>
<div class="w-full bg-slate-200 dark:bg-slate-700 h-1.5 rounded-full overflow-hidden mb-2">
<div class="bg-primary h-full w-[65%]"></div>
</div>
<p class="text-[11px] text-slate-600 dark:text-slate-400">6.5 GB of 10 GB used</p>
</div>
<button class="w-full py-3 px-4 bg-primary text-background-dark rounded-xl font-bold text-sm shadow-lg shadow-primary/20 hover:bg-primary/90 transition-all flex items-center justify-center gap-2">
<span class="material-symbols-outlined text-lg">play_circle</span>
                    Resume Lesson
                </button>
</div>
</aside>
<!-- Main Content -->
<main class="flex-1 overflow-y-auto px-8 py-6">
<!-- Top Nav -->
<header class="flex items-center justify-between mb-8 gap-6">
<div class="relative flex-1 max-w-xl">
<span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">search</span>
<input class="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-xl py-3 pl-12 pr-4 focus:ring-2 focus:ring-primary text-sm transition-all" placeholder="Search courses, formulas, topics..." type="text"/>
</div>
<div class="flex items-center gap-4">
<button class="p-2.5 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-[#9cb7ba] hover:bg-primary/10 hover:text-primary transition-all">
<span class="material-symbols-outlined">notifications</span>
</button>
<button class="p-2.5 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-[#9cb7ba] hover:bg-primary/10 hover:text-primary transition-all">
<span class="material-symbols-outlined">settings</span>
</button>
<div class="h-10 w-10 rounded-full border-2 border-primary overflow-hidden">
<img class="w-full h-full object-cover" data-alt="Student profile picture showing a friendly smile" src="https://lh3.googleusercontent.com/aida-public/AB6AXuDnMmEkX2-UgIkPn6P4tj2Iy87ootBMfex52CbSkzCE_oIXx5uyrJBNeAd_ZrSjD6FBZ9MR3aPPhiu-XUXym58WBCLsQn5mm3ONV_kaonvi05sArnns1_2IFxYHgB7I-7RZYI2raAR-Y_GbxnTWO6T1ig4XExUlFvzicWMzeMo1IaUOmnOGt-4J9xz92iHdfwJh0_Z-NA-oRFg6jpRukSEIes-FoyOH_Y3wHhG_G87KeHp4ULsuFufFEaAVdhpzF0E2Onkb-6KTycrW"/>
</div>
</div>
</header>
<!-- Page Heading -->
<section class="mb-10">
<h1 class="text-4xl font-black tracking-tight mb-2">Welcome back, Scientist!</h1>
<p class="text-slate-500 dark:text-[#9cb7ba] text-lg">Continue your journey through the molecular world.</p>
</section>
<!-- Featured "Continue Learning" Card -->
<section class="mb-10">
<div class="group relative overflow-hidden rounded-2xl bg-slate-900 dark:bg-[#1b2627] border border-slate-200 dark:border-slate-800 flex flex-col md:flex-row shadow-2xl">
<div class="w-full md:w-1/3 min-h-[240px] relative overflow-hidden">
<div class="absolute inset-0 bg-primary/20 mix-blend-overlay"></div>
<div class="absolute inset-0 bg-gradient-to-r from-background-dark/80 to-transparent"></div>
<img class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700" data-alt="Organic chemistry structural formula for carbon chains" src="https://lh3.googleusercontent.com/aida-public/AB6AXuBwGwjCGfIEn2fXOa8RZsFbjZ5hOK4_yl0MCSa1Yx2gFj4EVffcrtmfHNDnx3UB7VuOq9drQyxLtj9JYRZteB-LaNtrmHzMTqUc_CayCbVBHNUGQCq2MP8GXEFWdBgxyRBAGURIBMUzQXJ6oBqhjYKs8UEoQ8acYj1k7Ke7eWulXfEHVWw0OZwjblYvJmZoU43gXgOcE9vR1oqq9A5xixDjwUc-RFud3JqkzselcmNx9iX9Z4ryjgXkPyASASsTgSeasXcDvYNtcQSP"/>
<div class="absolute top-4 left-4 bg-primary text-background-dark text-[10px] font-bold px-2 py-1 rounded-md uppercase tracking-widest">Ongoing</div>
</div>
<div class="p-8 flex-1 flex flex-col justify-center">
<p class="text-primary text-xs font-bold tracking-[0.2em] mb-2">CONTINUE LEARNING</p>
<h2 class="text-2xl font-bold mb-4">Organic Chemistry: Carbon Chains</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
<div>
<p class="text-slate-400 text-sm mb-1 uppercase tracking-tight">Current Module</p>
<p class="font-medium">Module 4: Functional Groups &amp; Isomers</p>
</div>
<div>
<p class="text-slate-400 text-sm mb-1 uppercase tracking-tight">Next Challenge</p>
<p class="font-medium flex items-center gap-2">
<span class="material-symbols-outlined text-sm text-primary">quiz</span>
                                    Covalent Bonds Quiz
                                </p>
</div>
</div>
<div class="flex items-center gap-6">
<div class="flex-1">
<div class="flex justify-between mb-2">
<span class="text-xs font-medium text-[#9cb7ba]">Overall Course Completion</span>
<span class="text-xs font-bold text-primary">75%</span>
</div>
<div class="h-2 w-full bg-slate-800 rounded-full overflow-hidden">
<div class="h-full bg-primary shadow-[0_0_10px_rgba(13,223,242,0.5)] w-[75%]"></div>
</div>
</div>
<button class="bg-primary hover:bg-primary/90 text-background-dark font-bold px-8 py-3 rounded-xl transition-all shadow-lg shadow-primary/25">
                                Resume Lesson
                            </button>
</div>
</div>
</div>
</section>
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-10">
<!-- My Courses Grid -->
<div class="lg:col-span-2 space-y-6">
<div class="flex items-center justify-between">
<h2 class="text-2xl font-bold tracking-tight">My Courses</h2>
<div class="flex items-center gap-4">
    <button id="create-course-toggle" class="text-sm font-semibold px-3 py-2 border rounded-lg bg-white/5 hover:bg-white/10">Criar Curso</button>
    <button class="text-primary text-sm font-semibold hover:underline">View All</button>
</div>
</div>
<!-- Create course form (hidden por padrão) -->
<form id="create-course-form" class="hidden mt-4 mb-4 p-4 bg-white/3 rounded-xl border border-white/6">
    <div class="flex gap-3">
        <input id="course-title" placeholder="Título do curso" class="flex-1 px-3 py-2 rounded-lg bg-white/5 text-sm outline-none" />
        <input id="course-desc" placeholder="Descrição curta" class="flex-1 px-3 py-2 rounded-lg bg-white/5 text-sm outline-none" />
        <button type="submit" class="px-4 py-2 bg-primary text-background-dark rounded-lg font-bold">Criar</button>
    </div>
</form>

<div id="my-courses-list" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
<!-- Course Item 1 -->
<div class="bg-white dark:bg-[#1b2627] border border-slate-200 dark:border-slate-800 rounded-2xl p-5 hover:border-primary/50 transition-all cursor-pointer group">
<div class="flex items-start justify-between mb-4">
<div class="p-3 bg-slate-100 dark:bg-slate-800 rounded-xl text-primary">
<span class="material-symbols-outlined text-2xl">science</span>
</div>
<span class="text-[10px] text-slate-400 uppercase font-bold tracking-tighter">12 Lessons Left</span>
</div>
<h3 class="font-bold text-lg mb-1 group-hover:text-primary transition-colors">Inorganic Compounds</h3>
<p class="text-xs text-slate-500 dark:text-[#9cb7ba] mb-6">Last accessed: 2 days ago</p>
<div class="space-y-2">
<div class="h-1.5 w-full bg-slate-100 dark:bg-slate-800 rounded-full">
<div class="h-full bg-primary w-[45%]"></div>
</div>
<div class="flex justify-between text-[10px] font-bold text-slate-400">
<span>PROGRESS</span>
<span class="text-primary">45%</span>
</div>
</div>
</div>
<!-- Course Item 2 -->
<div class="bg-white dark:bg-[#1b2627] border border-slate-200 dark:border-slate-800 rounded-2xl p-5 hover:border-primary/50 transition-all cursor-pointer group">
<div class="flex items-start justify-between mb-4">
<div class="p-3 bg-slate-100 dark:bg-slate-800 rounded-xl text-primary">
<span class="material-symbols-outlined text-2xl">cyclone</span>
</div>
<span class="text-[10px] text-slate-400 uppercase font-bold tracking-tighter">Completed</span>
</div>
<h3 class="font-bold text-lg mb-1 group-hover:text-primary transition-colors">Fundamentals of Stoichiometry</h3>
<p class="text-xs text-slate-500 dark:text-[#9cb7ba] mb-6">Finished: Oct 12, 2023</p>
<div class="space-y-2">
<div class="h-1.5 w-full bg-slate-100 dark:bg-slate-800 rounded-full">
<div class="h-full bg-emerald-500 w-[100%]"></div>
</div>
<div class="flex justify-between text-[10px] font-bold text-emerald-500">
<span>CERTIFIED</span>
<span>100%</span>
</div>
</div>
</div>
</div>
</div>
<!-- Achievements Sidebar Section -->
<div class="space-y-6">
<h2 class="text-2xl font-bold tracking-tight">Chemistry Achievement</h2>
<div class="bg-white dark:bg-[#1b2627] border border-slate-200 dark:border-slate-800 rounded-2xl p-6 flex flex-col gap-6">
<div class="flex items-center gap-4 achievement-glow p-2 rounded-xl transition-all">
<div class="h-14 w-14 rounded-full bg-gradient-to-tr from-primary/30 to-primary flex items-center justify-center text-background-dark shadow-lg shadow-primary/20">
<span class="material-symbols-outlined text-3xl font-bold">water_drop</span>
</div>
<div>
<h4 class="font-bold text-sm">Molecule Master</h4>
<p class="text-[11px] text-slate-500 dark:text-[#9cb7ba]">Created 50 valid carbon bonds</p>
</div>
</div>
<div class="flex items-center gap-4 achievement-glow p-2 rounded-xl transition-all">
<div class="h-14 w-14 rounded-full bg-gradient-to-tr from-purple-500/30 to-purple-500 flex items-center justify-center text-white shadow-lg shadow-purple-500/20">
<span class="material-symbols-outlined text-3xl font-bold">bolt</span>
</div>
<div>
<h4 class="font-bold text-sm">Reaction Pro</h4>
<p class="text-[11px] text-slate-500 dark:text-[#9cb7ba]">Balanced 20 complex redox equations</p>
</div>
</div>
<div class="flex items-center gap-4 achievement-glow p-2 rounded-xl transition-all opacity-50 grayscale">
<div class="h-14 w-14 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center text-slate-500">
<span class="material-symbols-outlined text-3xl font-bold">magnification_small</span>
</div>
<div>
<h4 class="font-bold text-sm">Lab Researcher</h4>
<p class="text-[11px] text-slate-500 dark:text-[#9cb7ba]">Locked • 5 more simulations needed</p>
</div>
</div>
<button class="mt-2 w-full py-2.5 border-2 border-slate-200 dark:border-slate-800 rounded-xl text-xs font-bold hover:bg-slate-50 dark:hover:bg-slate-800 transition-all uppercase tracking-widest">
                            View All Badges
                        </button>
</div>
</div>
</div>
<!-- Community Feed / Activity -->
<section class="mb-10">
<h2 class="text-xl font-bold mb-6">Recent Community Activity</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div class="flex items-center gap-4 p-4 rounded-xl bg-slate-50 dark:bg-slate-800/30 border border-slate-100 dark:border-slate-800/50">
<img class="h-10 w-10 rounded-lg" data-alt="User avatar for student Maria" src="https://lh3.googleusercontent.com/aida-public/AB6AXuDU_SZOMM8QGNMbBN8kQY0qpyeoOyRfHXZaBg4uKrRNWxEnoV7xmVAgHVI9f9-60zSp2cNveFqfInd99I4G7PuQaZmh6iK1bMnFOwIsccqXB9PwmSawXdMFvdWxkwJYxt9XcGNOry6YQllg7Oo0QwR--WYmHKhM5CO_3M_fwEkrJwWobZdvUuttBoJHxsO6JQsNwuPh0_fcx7OMXWxRukEhG-pWXFJZ7_so-eRMndN4vVCnQVBuGL_Qz9bLvwVnhYOPtlLfqVbv6VpY"/>
<div class="flex-1 min-w-0">
<p class="text-sm font-medium truncate"><span class="text-primary">Maria S.</span> shared a new Titration study sheet</p>
<p class="text-xs text-slate-500">24 mins ago • Inorganic Group</p>
</div>
<button class="text-slate-400 hover:text-primary"><span class="material-symbols-outlined">forum</span></button>
</div>
<div class="flex items-center gap-4 p-4 rounded-xl bg-slate-50 dark:bg-slate-800/30 border border-slate-100 dark:border-slate-800/50">
<img class="h-10 w-10 rounded-lg" data-alt="User avatar for Professor Henderson" src="https://lh3.googleusercontent.com/aida-public/AB6AXuAsxd2ied4VJRTqtbdn18oToGUBC5RGvAudPjmdZadbaXCCiDVAGver1l24ZjjsBeSuqDx50wt_sI9__yLrZdU4khZ9UdhF5hHadQqYyOvGlDc600iKVlRvpzUrcH4sHSWPMbmxU1UbeG3RMGuz2WzQXZuaxqx4ypJsZu0-RjNrcuYByWXYfW9RRnBxjgHuQ_phk_t8Xbmtvpf93uGvAg4IMqNZlnYfTR55Dwu9F_Eo3RA9WzY7gEvKYtZQM8JVLr5APAYMf1g0AuLI"/>
<div class="flex-1 min-w-0">
<p class="text-sm font-medium truncate"><span class="text-primary">Prof. Henderson</span> posted a quiz announcement</p>
<p class="text-xs text-slate-500">1 hour ago • Organic Chemistry</p>
</div>
<button class="text-slate-400 hover:text-primary"><span class="material-symbols-outlined">forum</span></button>
</div>
</div>
</section>
</main>
</div>
<script src="/ui.js"></script>
<script type="module">
// use shared ui.apiFetch when available so Authorization header + cookie are sent
const api = async (path, method = 'GET', body) => {
    if (window.ui && window.ui.apiFetch) return window.ui.apiFetch(path, { method, body });
    const opts = {
        method,
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include'
    };
    if (body) opts.body = JSON.stringify(body);
    const res = await fetch(path, opts);
    if (!res.ok) {
        const text = await res.text().catch(()=>null);
        throw new Error(text || res.statusText);
    }
    return res.status===204 ? null : res.json();
};

const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

async function fetchAndRenderCourses(){
    try {
        const list = await api('/courses');
        const container = document.getElementById('my-courses-list');
        container.innerHTML = '';
        for (const c of list) {
            const card = document.createElement('div');
            card.className = 'bg-white dark:bg-[#1b2627] border border-slate-200 dark:border-slate-800 rounded-2xl p-5 hover:border-primary/50 transition-all cursor-pointer group';
            card.innerHTML = `
                <div class="flex items-start justify-between mb-4">
                    <div class="p-3 bg-slate-100 dark:bg-slate-800 rounded-xl text-primary">
                        <span class="material-symbols-outlined text-2xl">science</span>
                    </div>
                    <span class="text-[10px] text-slate-400 uppercase font-bold tracking-tighter">ID: ${c.id}</span>
                </div>
                <h3 class="font-bold text-lg mb-1 group-hover:text-primary transition-colors">${escapeHtml(c.title)}</h3>
                <p class="text-xs text-slate-500 dark:text-[#9cb7ba] mb-6">${escapeHtml(c.description || '')}</p>
                <div class="space-y-2" id="course-${c.id}-area"></div>
            `;
            container.appendChild(card);
            renderCourseControls(c);
        }
    } catch (err) {
        console.error('Erro ao buscar cursos', err);
    }
}

function escapeHtml(s){ return (s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

async function renderCourseControls(course){
    const area = document.getElementById(`course-${course.id}-area`);
    // buttons: enroll, show modules, add module (instrutor)
    const enrollBtn = document.createElement('button');
    enrollBtn.className = 'px-3 py-2 bg-primary text-background-dark rounded-lg font-bold mr-2';
    enrollBtn.textContent = 'Inscrever-se';
    enrollBtn.onclick = async ()=>{
        // require login/token
        const token = (window.ui && (window as any).ui.getToken) ? (window as any).ui.getToken() : localStorage.getItem('token');
        if (!token) { window.ui && window.ui.showMessage ? window.ui.showMessage('Faça login para inscrever-se','info') : alert('Faça login para inscrever-se'); return; }
        try{ await api(`/students/${course.id}/enroll`, 'POST'); window.ui && window.ui.showMessage ? window.ui.showMessage('Inscrito com sucesso','success') : alert('Inscrito com sucesso'); fetchAndRenderCourses(); }catch(e){ const msg = (e && (e.message||e.error)) ? (e.message||e.error) : JSON.stringify(e); window.ui && window.ui.showMessage ? window.ui.showMessage(msg,'error') : alert('Erro: '+msg); }
    };

    const showBtn = document.createElement('button');
    showBtn.className = 'px-3 py-2 border rounded-lg';
    showBtn.textContent = 'Ver módulos';
    showBtn.onclick = async ()=>{
        try{
            const detail = await api(`/courses/${course.id}`);
            renderModules(area, course.id, detail.modules || []);
        }catch(e){ const msg = (e && (e.message||e.error)) ? (e.message||e.error) : JSON.stringify(e); window.ui && window.ui.showMessage ? window.ui.showMessage(msg,'error') : alert('Erro: '+msg); }
    };

    const addModuleBtn = document.createElement('button');
    addModuleBtn.className = 'px-3 py-2 border rounded-lg';
    addModuleBtn.textContent = 'Adicionar módulo';
    addModuleBtn.onclick = async ()=>{
        try{
          const res = await window.ui.promptModal('Criar Módulo', [{ name: 'title', label: 'Título do módulo', placeholder: '' }]);
          if (!res || !res.title) return;
          await api(`/courses/${course.id}/modules`, 'POST', { title: res.title });
          window.ui && window.ui.showMessage ? window.ui.showMessage('Módulo criado','success') : alert('Módulo criado');
          showBtn.click();
        }catch(e){ const msg = (e && (e.message||e.error)) ? (e.message||e.error) : JSON.stringify(e); window.ui && window.ui.showMessage ? window.ui.showMessage(msg,'error') : alert('Erro: '+msg); }
    };

    area.innerHTML = '';
    const actions = document.createElement('div');
    actions.appendChild(enrollBtn);
    actions.appendChild(showBtn);
    actions.appendChild(addModuleBtn);
    area.appendChild(actions);
}

function renderModules(container, courseId, modules){
    const wrap = document.createElement('div');
    wrap.className = 'mt-4';
    for (const m of modules){
        const mdiv = document.createElement('div');
        mdiv.className = 'mb-3 p-3 rounded-lg border border-white/6 bg-white/2';
        mdiv.innerHTML = `<div class="flex justify-between items-center"><strong>${escapeHtml(m.title)}</strong><div></div></div><div id="module-${m.id}-lessons" class="mt-2"></div>`;
        const lessonsContainer = mdiv.querySelector(`#module-${m.id}-lessons`);
        // Add lesson button
        const addLessonBtn = document.createElement('button');
        addLessonBtn.className = 'mt-2 px-3 py-1 text-sm border rounded';
        addLessonBtn.textContent = 'Adicionar aula';
        addLessonBtn.onclick = async ()=>{
            try{
                const res = await window.ui.promptModal('Criar Aula', [
                  { name: 'title', label: 'Título da aula' },
                  { name: 'video', label: 'Link do vídeo (URL)', placeholder: '' },
                  { name: 'material', label: 'Material de apoio (texto simples)', placeholder: '' }
                ]);
                if (!res || !res.title) return;
                await api(`/courses/${courseId}/modules/${m.id}/lessons`, 'POST', { title: res.title, videoUrl: res.video, material: res.material });
                window.ui && window.ui.showMessage ? window.ui.showMessage('Aula criada','success') : alert('Aula criada');
                const detail = await api(`/courses/${courseId}`);
                renderModules(container, courseId, detail.modules || []);
            }catch(e){ const msg = (e && (e.message||e.error)) ? (e.message||e.error) : JSON.stringify(e); window.ui && window.ui.showMessage ? window.ui.showMessage(msg,'error') : alert('Erro: '+msg); }
        };
        mdiv.appendChild(addLessonBtn);
        // render lessons
        if (m.lessons && m.lessons.length){
            for (const l of m.lessons){
                const ldiv = document.createElement('div');
                ldiv.className = 'mt-2 p-2 rounded bg-white/5 flex items-start gap-3';
                ldiv.innerHTML = `<div class="flex-1"><div class="font-semibold">${escapeHtml(l.title)}</div><div class="text-xs text-slate-400">${escapeHtml(l.material||'')}</div><a class="text-xs text-primary" href="${escapeHtml(l.videoUrl||'#')}" target="_blank">Ver vídeo</a></div>`;
                const completeBtn = document.createElement('button');
                completeBtn.className = 'px-3 py-1 bg-primary text-background-dark rounded ml-2 text-sm';
                completeBtn.textContent = 'Marcar concluída';
                completeBtn.onclick = async ()=>{
                    try{ await api(`/students/${courseId}/modules/${m.id}/lessons/${l.id}/complete`, 'PATCH'); window.ui && window.ui.showMessage ? window.ui.showMessage('Marcado como concluído','success') : alert('Marcado como concluído');
                        const prog = await api(`/students/${courseId}/progress`);
                        window.ui && window.ui.showMessage ? window.ui.showMessage('Progresso: ' + (prog.percent||0) + '%','info') : alert('Progresso: ' + (prog.percent||0) + '%');
                    }catch(e){ const msg = (e && (e.message||e.error)) ? (e.message||e.error) : JSON.stringify(e); window.ui && window.ui.showMessage ? window.ui.showMessage(msg,'error') : alert('Erro: '+msg); }
                };
                ldiv.appendChild(completeBtn);
                lessonsContainer.appendChild(ldiv);
            }
        } else {
            const empty = document.createElement('div'); empty.className='text-sm text-slate-400'; empty.textContent='Sem aulas'; lessonsContainer.appendChild(empty);
        }
        wrap.appendChild(mdiv);
    }
    // replace existing modules area
    const existing = container.querySelector('.modules-render');
    if (existing) existing.remove();
    const holder = document.createElement('div'); holder.className='modules-render mt-3'; holder.appendChild(wrap);
    container.appendChild(holder);
}

// Create course form behavior
$('#create-course-toggle').addEventListener('click', ()=>{
    $('#create-course-form').classList.toggle('hidden');
});
$('#create-course-form').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const title = $('#course-title').value.trim();
    const description = $('#course-desc').value.trim();
    if (!title) { window.ui && window.ui.showMessage ? window.ui.showMessage('Título obrigatório','error') : alert('Título obrigatório'); return; }
    try{ await api('/courses', 'POST', { title, description }); window.ui && window.ui.showMessage ? window.ui.showMessage('Curso criado','success') : alert('Curso criado'); $('#course-title').value=''; $('#course-desc').value=''; $('#create-course-form').classList.add('hidden'); fetchAndRenderCourses(); }catch(e){ const msg = (e && (e.message||e.error)) ? (e.message||e.error) : JSON.stringify(e); window.ui && window.ui.showMessage ? window.ui.showMessage(msg,'error') : alert('Erro: '+msg); }
});

// initial load - require auth for student dashboard
(async function ensureAuthAndLoad(){
    try {
        // prefer window.ui.apiFetch if present (handles cookies and Authorization)
        if (window.ui && window.ui.apiFetch) {
            await window.ui.apiFetch('/auth/me');
        } else {
            await api('/auth/me');
        }
        fetchAndRenderCourses();
    } catch (err) {
        // not authenticated - redirect to public landing or login
        console.warn('Usuário não autenticado, redirecionando para login.', err);
        window.location.href = '/index.html';
    }
})();
</script>
</body></html>
<script src="/superadmin-link.js"></script>